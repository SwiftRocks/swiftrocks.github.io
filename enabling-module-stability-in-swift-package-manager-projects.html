<!DOCTYPE html>
<html lang="en">

  <head>

    <script src="https://use.fontawesome.com/afd448ce82.js"></script>
    
    <!-- Meta Tag -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO -->
    <meta name="author" content="Bruno Rocha">
    <meta name="keywords" content="iOS, Xcode, Swift, Articles, Tutorials, OBJ-C, Objective-C, Apple">
    <meta name="description" content="Uh-oh! You've been visited by the module stability fairy. Let's see how to solve this classic error.">
    <meta name="title" content="Enabling Module Stability in Swift Package Manager Projects">
    <meta name="url" content="https://swiftrocks.com/enabling-module-stability-in-swift-package-manager-projects">
    <meta name="image" content="https://swiftrocks.com/images/thumbs/thumb.jpg?4">
    <meta name="copyright" content="Bruno Rocha">
    <meta name="robots" content="index,follow">

    <meta property="og:title" content="Enabling Module Stability in Swift Package Manager Projects"/>
    <meta property="og:image" content="https://swiftrocks.com/images/thumbs/thumb.jpg?4"/>
    <meta property="og:description" content="Uh-oh! You've been visited by the module stability fairy. Let's see how to solve this classic error."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://swiftrocks.com/enabling-module-stability-in-swift-package-manager-projects"/>

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://swiftrocks.com/images/thumbs/thumb.jpg?4"/>
    <meta name="twitter:image:alt" content="Page Thumbnail"/>
    <meta name="twitter:title" content="Enabling Module Stability in Swift Package Manager Projects"/>
    <meta name="twitter:description" content="Uh-oh! You've been visited by the module stability fairy. Let's see how to solve this classic error."/>
    <meta name="twitter:site" content="@rockbruno_"/>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="images/favicon/favicon-2.ico">
    <link rel="mask-icon" href="images/favicon/favicon-2.ico">
    <link rel="apple-touch-icon" href="images/favicon/apple-touch-icon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:light,lightitalic,regular,regularitalic,medium,mediumitalic,bold,bolditalic,black,blackitalic">
    
    

  <!-- Bootstrap CSS Plugins --> 
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
  <!-- Prism CSS Stylesheet --> 
  <link rel="stylesheet" type="text/css" href="css/prism3.css"> 
  <!-- Main CSS Stylesheet --> 
  <link rel="stylesheet" type="text/css" href="css/style43.css"> 
  <link rel="stylesheet" type="text/css" href="css/sponsor3.css">
    
    <!-- HTML5 shiv and Respond.js support IE8 or Older for HTML5 elements and media queries -->
    <!--[if lt IE 9]>
	   <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	   <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script type="application/ld+json">
  {
"@context": "https://schema.org",
"@type": "BlogPosting",
"mainEntityOfPage": {
  "@type": "WebPage",
  "@id": "https://swiftrocks.com/enabling-module-stability-in-swift-package-manager-projects"
},
"image": [
  "https://swiftrocks.com.com/images/logo/logo.png"
],
"datePublished": "2021-10-26T14:00:00+02:00",
"dateModified": "2021-10-26T14:00:00+02:00",
"author": {
  "@type": "Person",
  "name": "Bruno Rocha"
},
 "publisher": {
  "@type": "Organization",
  "name": "SwiftRocks",
  "logo": {
    "@type": "ImageObject",
    "url": "https://swiftrocks.com.com/images/logo/logo.png"
  }
},
"headline": "Enabling Module Stability in Swift Package Manager Projects",
    "abstract": "Uh-oh! You've been visited by the module stability fairy. Let's see how to solve this classic error."
}
  </script>
    

  </head>

 <body>
      
    
    
     
    
    
  <div id="main"> 
<!-- Blog Header --> 
         <!-- Blog Post (Right Sidebar) Start --> 
   <div class="container"> 
                 <div class="col-xs-12">
                    <div class="page-body">
                    	<div class="row">
         <div><a href="https://swiftrocks.com">
           <img id="logo" alt="SwiftRocks" src="images/bg/logo.png" style="margin-top: 32px; max-width: 100%; width: auto; height: auto;"> 
         </a></div>
                            <div class="content-page" id="WRITEIT_DYNAMIC_CONTENT">
<!--WRITEIT_POST_NAME=Enabling Module Stability in Swift Package Manager Projects-->
<!--WRITEIT_POST_HTML_NAME=enabling-module-stability-in-swift-package-manager-projects-->

<!--Add here the additional properties that you want each page to possess.-->
<!--These properties can be used to change content in the template page or in the page itself as shown here.-->
<!--Properties must start with 'WRITEIT_POST'.-->
<!--Writeit provides and injects WRITEIT_POST_NAME and WRITEIT_POST_HTML_NAME by default.-->

<!--WRITEIT_POST_SHORT_DESCRIPTION=Uh-oh! You've been visited by the module stability fairy. Let's see how to solve this classic error.-->

<!--DateFormat example: 2021-10-12T14:00:00+02:00-->
<!--WRITEIT_POST_SITEMAP_DATE_LAST_MOD=2021-10-26T14:00:00+02:00-->
<!--WRITEIT_POST_SITEMAP_DATE=2021-10-26T14:00:00+02:00-->

<title>Enabling Module Stability in Swift Package Manager Projects</title>
<div class="blog-post">
  <div class="post-title-index">
    <h1>Enabling Module Stability in Swift Package Manager Projects</h1>
  </div>  
  <div class="post-info">
    <div class="category category-compiler">Compiler</div>
    <div class="category category-swift">Swift</div>
    <div class="post-info-text">Published on 26 Oct 2021</div>
  </div>
<p><i>Module compiled with Swift X cannot be imported by the Swift Y compiler</i></p>
<p>Uh-oh! You've been visited by the module stability fairy. <i>"Wait a second, didn't they fix this in Swift 5?"</i> you ask, to no avail.</p>
<div class="sponsor-article-ad-auto hidden"></div>
<p>Technically, yes and no. Stable binary interfaces were introduced in Swift 5 to allow apps built with the Swift 5.0 compiler to use the Swift runtime and standard library built into the operating system, and to make sure that existing apps will remain compatible with new versions of the Swift runtime in future operating system releases.</p>
<p>This error refers to <i>module stability</i>, which was introduced in Swift 5.1 to allow Swift modules built with different compiler versions to be used together in one app. While this is possible, it's something you need to explictly enable. This is because module stability currently requires <b>Library Evolution</b> to also be enabled, which is a setting that ensures that newer versions of your module will not break previous releases.</p>
<p>If you search this error on Google, you'll get a bunch of StackOverflow answers saying "well, all you have to do is enable this in Xcode!" Pretty cool, except that I'm not using Xcode, god damnit!</p>
<h2>Enabling Module Stability in the CLI</h2>
<p>Before enabling module stability, make sure that you actually need it. According to Swift's official docs, library evolution support should only be used when a framework is going to be built and updated separately from its clients.</p>
<p>This use case is exactly how you end up with that error in the first place, so I'm assuming that you're enabling it for the right reasons.</p>
<p>To compile with module stability outside of Xcode, we need to pass the following flags:</p>
<ul> 
  <li>-emit-module-interface</li> 
  <li>-enable-library-evolution</li> 
</ul>
<p>For SPM, you can do it by passing <code>Xswiftc</code> flags like this:</p>
<pre>
<code>swift build -c release -Xswiftc -emit-module-interface -Xswiftc -enable-library-evolution</code>
</pre>
<p>This will result in a series of <code>.swiftinterface</code> files being generated, which you need ship alongside the binary.</p>
<h2>Library Evolution Implications</h2>
<p>While this is straight-forward, enabling module stability / library evolution means you now need to be careful about how you make changes to your library. Because clients can now technically swap versions of your framework without being recompiled, you cannot introduce binary breaking changes in future updates. The compiler has features to assist you with this, so you'll know exactly when this happens.</p>
<p>I wish it was possible to uncouple these two concepts, because you don't need to worry about binary compability if you're also in control of the clients. This is the case of <a href="https://github.com/rockbruno/SwiftInfo">SwiftInfo</a>, in which I need use module stability due to way the Swift inputs are read. The Swift team is aware of this, so maybe this will happen in the near future.</p>
<h2>Module Stability Limitations</h2>
<p>If you enable module stability, you need to make sure you don't have types with the same name as your module. Basically, interface files will reference types with the qualified format <code>Module.Type</code>, which you can't do in Swift if they have the same name. This is a limitation of the compiler that has not yet been resolved, <a href="https://forums.swift.org/t/frameworkname-is-not-a-member-type-of-frameworkname-errors-inside-swiftinterface/28962">and you can read more about it here.</a>
<p>One way to workaround this is to modify the <code>.swiftinterface</code> file after compiling the framework to remove all broken module references. My colleague Andr√© Alves added the following script to solve this in SwiftInfo, which depends on a framework called <code>XcodeProj</code> that has this issue:</p>
<pre>
<code>sed -i '' 's/XcodeProj\.//g' XcodeProj.swiftinterface</code>
</pre>
<div class="sponsor-article-ad-auto hidden"></div>
<p>Essentially, this transforms references to <code>XcodeProj.XcodeProj</code> into <code>XcodeProj</code>, countering the limitation.</p>
</div>
</div>
                              
   

    <div class="blog-post" style="margin-top: 8px; margin-bottom: 32px;">
      <div class="footer-text">
        Thanks for reading! If you want to see more content like this, follow me on <a href="https://twitter.com/rockbruno_">Twitter</a> or <a href="https://mastodon.online/@rockbruno">Mastodon</a>!
        <ul>
          <li>        <a href="https://twitter.com/intent/tweet?via=rockbruno_&hashtags=swiftrocks,ios,swiftlang&url=https%3A%2F%2Fswiftrocks.com%2Fenabling-module-stability-in-swift-package-manager-projects&text=Enabling Module Stability in Swift Package Manager Projects" target="_blank" class="share">Share this page</a> on Twitter</li>
          <li>Subscribe via <a href="https://swiftrocks.com/rss.xml">RSS</a> or <a href="https://swiftrocks.us17.list-manage.com/subscribe/post?u=d6bdd39e59b8d9b8f2b8d4852&id=cbca5f3532">e-mail</a></li>
        </ul>
        <a href="https://swiftrocks.com">See all articles</a>
      </div>

    </div>

                         </div>

</div>
                        
                           
                         </div>
                     
                     
                  </div>
                  <!-- Blog Post (Right Sidebar) End -->
                
            </div>
         </div>
      </div>
    
    
    <!-- All Javascript Plugins  -->
  <script type="text/javascript" src="js/jquery.min.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script type="text/javascript" src="js/prism3.js"></script> 
    <!-- Main Javascript File  -->
    <script type="text/javascript" src="js/scripts29.js"></script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H8KZTWSQ1R"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-H8KZTWSQ1R');
</script>

   </body>
 </html>
